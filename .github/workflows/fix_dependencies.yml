name: Fix Dependencies (RecyclerView)

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  fix_gradle:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Update build.gradle.kts
        run: |
          cat <<EOF > app/build.gradle.kts
          plugins {
              id("com.android.application")
              id("org.jetbrains.kotlin.android")
          }

          android {
              namespace = "com.ivpn.app"
              compileSdk = 34

              defaultConfig {
                  applicationId = "com.ivpn.app"
                  minSdk = 24
                  targetSdk = 34
                  versionCode = 1
                  versionName = "1.0.0"
              }

              buildTypes {
                  release {
                      isMinifyEnabled = false
                      proguardFiles(getDefaultProguardFile("proguard-android-optimize.txt"), "proguard-rules.pro")
                  }
              }
              compileOptions {
                  sourceCompatibility = JavaVersion.VERSION_1_8
                  targetCompatibility = JavaVersion.VERSION_1_8
              }
              kotlinOptions {
                  jvmTarget = "1.8"
              }
              buildFeatures {
                  viewBinding = true
              }
          }

          dependencies {
              implementation("androidx.core:core-ktx:1.12.0")
              implementation("androidx.appcompat:appcompat:1.6.1")
              implementation("com.google.android.material:material:1.11.0")
              implementation("androidx.constraintlayout:constraintlayout:2.1.4")
              implementation("com.squareup.okhttp3:okhttp:4.12.0")
              implementation("com.google.code.gson:gson:2.10.1")
              
              // کتابخانه‌های اضافه شده برای رفع کرش
              implementation("androidx.recyclerview:recyclerview:1.3.2") 
              implementation("androidx.cardview:cardview:1.0.0")
          }
          EOF

      - name: Commit Changes
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
          git add .
          git commit -m "Added RecyclerView dependency to fix crash"
          git push
